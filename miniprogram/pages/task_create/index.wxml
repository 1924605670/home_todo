<view class="container">
  <view class="header mb-20 flex-row justify-between align-center">
    <text class="text-h2">发布新任务</text>
    <button class="btn-copy" bindtap="copyYesterdayTasks">
        <image class="icon-copy" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMTI5NmRiIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHJlY3QgeD0iOSIgeT0iOSIgd2lkdGg9IjEzIiBoZWlnaHQ9IjEzIiByeD0iMiIgcnk9IjIiPjwvcmVjdD48cGF0aCBkPSJNNSAxNWgyYTIgMiAwIDAgMSAyLTJWM2EyIDIgMCAwIDEgMi0yaDEwIj48L3BhdGg+PC9zdmc+"></image>
        <text>复制昨天</text>
    </button>
  </view>

  <view class="card">
    <!-- 任务名称 -->
    <view class="form-item border-bottom">
      <input class="input-box mb-10" placeholder="例如：洗碗、做作业" value="{{title}}" bindinput="onTitleInput"/>
      <!-- 快捷建议 Quick Pick -->
      <scroll-view scroll-x="true" class="quick-scroll" enable-flex="true">
        <view class="quick-list flex-row">
          <view class="tag tag-primary mr-20" 
                wx:for="{{quickOptions}}" wx:key="*this"
                bindtap="onQuickSelect" data-value="{{item}}">
            {{item}}
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- 任务属性行：类型 + 截止时间 -->
    <view class="form-item border-bottom">
        <view class="mb-20">
            <text class="text-h3 mb-10" style="display:block;">类型</text>
            <scroll-view scroll-x="true" class="quick-scroll" enable-flex="true">
                <view class="quick-list flex-row">
                    <view class="tag-type {{typeIndex === index ? 'active' : ''}} mr-20" 
                        wx:for="{{types}}" wx:key="*this"
                        bindtap="onTypeSelect" data-index="{{index}}">
                        {{item}}
                    </view>
                </view>
            </scroll-view>
        </view>

        <view class="mb-20">
            <view class="flex-row justify-between align-center mb-10">
                <text class="text-h3">截止时间</text>
                <view class="flex-row">
                    <picker mode="date" value="{{date}}" start="2024-01-01" bindchange="onDateChange">
                        <view class="picker-value bg-gray mr-10">{{date}}</view>
                    </picker>
                    <picker mode="time" value="{{time}}" bindchange="onTimeChange">
                        <view class="picker-value bg-gray">{{time}}</view>
                    </picker>
                </view>
            </view>
            
            <!-- 智能截止时间建议 -->
            <scroll-view scroll-x="true" class="quick-scroll" enable-flex="true">
                <view class="quick-list flex-row">
                    <view class="tag-deadline {{date === item.date && time === item.time ? 'active' : ''}} mr-20" 
                        wx:for="{{deadlineOptions}}" wx:key="label"
                        bindtap="onDeadlineSelect" data-date="{{item.date}}" data-time="{{item.time}}">
                        {{item.label}}
                    </view>
                </view>
            </scroll-view>
        </view>

        <!-- 积分奖励 -->
        <view>
            <text class="text-h3 mb-10" style="display:block;">积分奖励</text>
            <view class="flex-row">
                <view class="tag-point {{rewardPoints === item ? 'active' : ''}} mr-20" 
                      wx:for="{{pointOptions}}" wx:key="*this"
                      bindtap="onPointChange" data-value="{{item}}">
                    {{item}} 分
                </view>
            </view>
        </view>
    </view>

    <!-- 执行人 -->
    <view class="form-item border-bottom">
      <view class="text-h3 mb-10">执行人</view>
      <scroll-view scroll-x="true" class="member-scroll">
        <view class="member-list flex-row">
          <view class="member-item flex-col align-center {{assigneeIndex === index ? 'active' : ''}}" 
                wx:for="{{members}}" wx:key="_id"
                bindtap="onAssigneeChange" data-index="{{index}}">
            <image class="avatar {{assigneeIndex === index ? 'avatar-active' : ''}}" src="{{item.avatarUrl || '../../images/user.png'}}"></image>
            <text class="text-desc mt-10 text-truncate">{{item.nickName}}</text>
            <view class="check-mark" wx:if="{{assigneeIndex === index}}">✓</view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 优先级 -->
    <view class="form-item mt-10">
      <view class="priority-group flex-row justify-between">
        <view class="priority-item {{priority === item.value ? 'active ' + item.value : ''}}" 
              wx:for="{{priorities}}" wx:key="value"
              bindtap="onPriorityChange" data-value="{{item.value}}">
          <text>{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="footer-btn">
    <button class="btn-primary" bindtap="submitTask">立即发布</button>
  </view>
</view>