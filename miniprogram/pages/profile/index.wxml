<view class="container">
  <!-- ф╕кф║║ф┐бцБп -->
  <view class="user-card card flex-row align-center mb-30">
    <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar" style="padding:0; background:none; border:none; width: 120rpx; height: 120rpx;">
        <image class="avatar-lg" src="{{member.avatarUrl || userInfo.avatarUrl || '../../images/user.png'}}" style="width: 100%; height: 100%; border-radius: 50%;"></image>
    </button>
    
    <view class="flex-col ml-20" style="flex:1;">
      <view class="flex-row align-center mb-10">
        <input type="nickname" class="text-h2 mr-10" placeholder="чВ╣хЗ╗ф┐оцФ╣цШ╡чз░" value="{{member.nickName || userInfo.nickName}}" bind:change="onNicknameChange" style="background: transparent; border: none; font-size: 36rpx; width: 300rpx;"/>
        <view class="role-tag" wx:if="{{member}}">{{member.role === 'admin' ? 'чобчРЖхСШ' : 'цИРхСШ'}}</view>
      </view>
      <text class="text-desc">чзпхИЖ: {{member.points || 0}}</text>
    </view>
  </view>

  <!-- цЬкхКахЕехо╢х║нчК╢цАБ -->
  <view class="no-family-section" wx:if="{{!hasFamily}}">
    <view class="card action-card flex-col align-center">
      <image src="../../images/home.png" class="action-icon mb-20"></image>
      <view class="text-h3 mb-10">хИЫх╗║цЦ░хо╢х║н</view>
      <view class="text-desc mb-30">цИСцШпхо╢щХ┐я╝МцИСшжБх╗║члЛф╕Аф╕кхо╢х║нф╗╗хКбчй║щЧ┤</view>
      <button class="btn-primary" bindtap="getUserProfile" data-type="create">хИЫх╗║хо╢х║н</button>
    </view>
    <view class="card action-card flex-col align-center">
      <image src="../../images/add.png" class="action-icon mb-20" style="opacity: 0.5;"></image>
      <view class="text-h3 mb-10">хКахЕехо╢х║н</view>
      <view class="text-desc mb-30">цИСцЬЙщВАшп╖чаБя╝МцИСшжБхКахЕех╖▓цЬЙчЪДхо╢х║н</view>
      <button class="btn-secondary" bindtap="getUserProfile" data-type="join">хКахЕехо╢х║н</button>
    </view>
  </view>

  <!-- х╖▓хКахЕехо╢х║нчК╢цАБ -->
  <view class="family-section" wx:else>
    <view class="card family-info">
      <view class="flex-row justify-between align-center mb-30">
        <text class="text-h2">{{family.name}}</text>
        <view class="invite-btn" bindtap="copyInviteCode">
          <text class="mr-10">щВАшп╖чаБ: {{family.invite_code}}</text>
          <text class="copy-icon">тЭР</text>
        </view>
      </view>
      
      <view class="divider mb-30"></view>
      
      <view class="members-list">
        <view class="text-h3 mb-20">хо╢х║нцИРхСШ ({{members.length}})</view>
        <view class="member-grid">
          <view class="member-cell flex-col align-center" wx:for="{{members}}" wx:key="_id">
            <image class="avatar mb-10" src="{{item.avatarUrl || '../../images/user.png'}}"></image>
            <text class="text-body">{{item.nickName}}</text>
            <text class="text-desc tag tag-primary mt-10" wx:if="{{item.role === 'admin'}}">чобчРЖхСШ</text>
          </view>
          <!-- щВАшп╖цМЙщТо -->
          <view class="member-cell flex-col align-center" bindtap="copyInviteCode">
            <view class="add-member-btn mb-10">+</view>
            <text class="text-desc">щВАшп╖</text>
          </view>
        </view>
      </view>
    </view>

    <!-- хКЯшГ╜хИЧшби -->
    <view class="card menu-list">
      <view class="menu-item flex-row justify-between align-center border-bottom">
        <view class="flex-row align-center">
          <text class="menu-icon mr-20">ЁЯУК</text>
          <text class="text-body">цХ░цНохп╝хЗ║</text>
        </view>
        <text class="text-desc">></text>
      </view>
      <view class="menu-item flex-row justify-between align-center">
        <view class="flex-row align-center">
          <text class="menu-icon mr-20">тД╣я╕П</text>
          <text class="text-body">хЕ│ф║ОцИСф╗м</text>
        </view>
        <text class="text-desc">></text>
      </view>
    </view>
  </view>

  <!-- хИЫх╗║хо╢х║нх╝╣чкЧ -->
  <view class="modal-mask" wx:if="{{showCreateModal}}">
    <view class="modal-content card">
      <view class="text-h3 text-center mb-30">хИЫх╗║хо╢х║н</view>
      <input class="input-box mb-30" placeholder="ч╗Щхо╢х║нш╡╖ф╕кхРНхнЧ (хжВ: х┐лф╣Рф╣Лхо╢)" bindinput="onInputFamilyName"/>
      <view class="modal-footer flex-row justify-between">
        <button class="btn-secondary mr-20" bindtap="closeModal">хПЦц╢И</button>
        <button class="btn-primary" bindtap="confirmCreate">хИЫх╗║</button>
      </view>
    </view>
  </view>

  <!-- хКахЕехо╢х║нх╝╣чкЧ -->
  <view class="modal-mask" wx:if="{{showJoinModal}}">
    <view class="modal-content card">
      <view class="text-h3 text-center mb-30">хКахЕехо╢х║н</view>
      <input class="input-box mb-30" placeholder="шп╖ш╛УхЕе6ф╜НщВАшп╖чаБ" bindinput="onInputInviteCode"/>
      <view class="modal-footer flex-row justify-between">
        <button class="btn-secondary mr-20" bindtap="closeModal">хПЦц╢И</button>
        <button class="btn-primary" bindtap="confirmJoin">хКахЕе</button>
      </view>
    </view>
  </view>
</view>